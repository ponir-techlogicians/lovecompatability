{% extends "layout/main.html" %}
{% load static %}
{% load i18n %}
{% block content %}
<script>
    // Function to get user's current location and submit the form
    function getLocationAndSearch(event) {
        event.preventDefault(); // Prevent form from submitting immediately

        if (navigator.geolocation) {
            // Request user's current position
            navigator.geolocation.getCurrentPosition(function(position) {
                // Get the latitude and longitude from the geolocation API
                var latitude = position.coords.latitude;
                var longitude = position.coords.longitude;

                // Set the values to the hidden fields in the form
                document.getElementById("latitude").value = latitude;
                document.getElementById("longitude").value = longitude;

                // Now submit the form
                document.getElementById("searchForm").submit();
            }, function(error) {
                alert("{% trans 'Error retrieving your location. Please enable location services.' %}");
            });
        } else {
            alert("{% trans 'Geolocation is not supported by this browser.' %}");
        }
    }
</script>
<div class="topBanner pc">
  <img src="{% static 'app/img/pc_top.png' %}" alt="">
</div>
<div class="loveWrap search">
    <div class="search__tit">
        {% trans "The most popular in my area" %}
    </div>
    <form class="search__box" method="get" id="searchForm" onsubmit="getLocationAndSearch(event)">
        <input type="text" class="search__input" placeholder="{% trans 'Name' %}" name="query" value="{{ search_key }}">
        <button class="search__btn" type="submit">{% trans "Search" %}</button>
        <input type="hidden" id="amount" name="radius" value="1"/>
      <input type="hidden" id="latitude" name="latitude">
      <input type="hidden" id="longitude" name="longitude">
    </form>
    <div class="search__range">
      <div id="slider"></div>
        <div class="search__rangeItem">{% trans "1km" %}</div>
        <div class="search__rangeItem">{% trans "50km" %}</div>
        <div class="search__rangeItem">{% trans "200km" %}</div>
        <div class="search__rangeItem">{% trans "world" %}</div>
    </div>


    <div class="search__list">
      <div class="search__listHeader">
          <div class="search__listHeader__item">{% trans "Rank" %}</div>
          <div class="search__listHeader__item">{% trans "Name" %}</div>
          <div class="search__listHeader__item">{% trans "Mentioned (times)" %}</div>
      </div>
      <ul class="search__listBody">
        {% for name, count , rank in top_names_with_ranks %}
            <li class="row">
                <div class="search__listBody__itemWrap">
                    <div class="search__listBody__item {% if forloop.counter ==  search_rank %} search__listFooter__item {% endif %}">{{ rank }}</div>
                    <div class="search__listBody__item {% if forloop.counter ==  search_rank %} search__listFooter__item {% endif %}">{{ name }}</div>
                    <div class="search__listBody__item {% if forloop.counter ==  search_rank %} search__listFooter__item {% endif %}">{{ count }}</div>

                </div>
                {% if forloop.counter ==  search_rank %}
                    <button type="button" class="search__with" onclick="goto();">
                        {% trans "With who?" %}
                    </button>
                {% endif %}
            </li>
        {% endfor %}
      </ul>

      <!-- The area is exposed when the search results are not ranked. -->

     {% if results %}
      {% if mention_count > 0 and search_rank > 10 %}
          <div class="search__listFooter">
            <div class="row">
              <div class="search__listBody__itemWrap">
                  <div class="search__listFooter__item">{{search_rank}}</div>
                  <div class="search__listFooter__item">{{ search_key }}</div>
                  <div class="search__listFooter__item">{{ mention_count }}</div>
              </div>
              {% if mention_count > 0 and search_rank > 10 %}
                    <button type="button" class="search__with" onclick="goto();">
                        {% trans "With who?" %}
                    </button>
              {% endif %}
            </div>
          </div>
      {% endif %}
      {% endif %}
    </div>

    {% comment %}<a href="{% url 'list' %}?key={{ search_key }}&radius={{ radius_input }}&lat={{ lat }}&lon={{ lon }}" class="search__with">
      With who?
    </a>{% endcomment %}

  </div>
  <div class="loveWrap__ad">
{#      <img src="{% static 'app/img/banner01.png' %}" alt="">#}
{#      <p>{% trans "We will resolve your curiosities" %}</p>#}
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2655483668363741"
     crossorigin="anonymous"></script>
<!-- Ads Banner-1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2655483668363741"
     data-ad-slot="7053690987"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
  </div>
  <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
  <script src="https://code.jquery.com/ui/1.14.1/jquery-ui.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>

  <script>
    $(function() {
      $("#slider" ).slider({
        value:1,
        min: 1,
        max: 4,
        slide: function( event, ui ) {
          {#$("#amount").val( "$" + ui.value );#}
          $("#amount").val(ui.value);
        var currentUrl = new URL(window.location.href);
        currentUrl.searchParams.set('radius', ui.value);
        window.history.replaceState({}, '', currentUrl);
        window.location.reload();
        }
      });
      {% if radius_input == '1' %}
          $("#slider").slider("value", 1);
          $("#amount").val(1);
      {% endif %}
      {% if radius_input == '2' %}
          $("#slider").slider("value", 2);
          $("#amount").val(2);
      {% endif %}
      {% if radius_input == '3' %}
          $("#slider").slider("value", 3);
          $("#amount").val(3);
      {% endif %}
      {% if radius_input == '4' %}
          $("#slider").slider("value", 4);
          $("#amount").val(4);
      {% endif %}

    } );

    function goto(){
        window.location.href="{% url 'list' %}?key={{ search_key }}&radius={{ radius_input }}&lat={{ lat }}&lon={{ lon }}"
    }
  </script>
{% endblock %}